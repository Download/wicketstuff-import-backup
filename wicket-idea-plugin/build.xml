<?xml version="1.0"?>

<!--
  ~ Copyright 2006 Holmbech Development
  ~
  ~    Licensed under the Apache License, Version 2.0 (the "License");
  ~    you may not use this file except in compliance with the License.
  ~    You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~    Unless required by applicable law or agreed to in writing, software
  ~    distributed under the License is distributed on an "AS IS" BASIS,
  ~    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~    See the License for the specific language governing permissions and
  ~    limitations under the License.
  -->

<project name="wicketassistant" default="init" basedir=".">

    <property file="project.properties"/>
    <property name="name" value="wicketassistant"/>
    <property name="src.dir" value="."/>
    <property name="src.java.dir" value="./src"/>
    <property name="build.dir" value="build"/>
    <property name="dist.dir" value="dist"/>
    <property name="deploy.dir" value="${idea.plugin.dir}"/>
    <property name="deploy.sandbox.dir" value="${idea.plugin.sandbox.dir}"/>
    <property name="javadoc.dir" value="doc"/>
    <property name="compile" value="modern"/>
    <property name="compile.debug" value="true"/>
    <property name="compile.deprecation" value="true"/>
    <property name="compile.optimize" value="true"/>
    <property name="compile.target" value="1.4"/>
    <property name="compile.source" value="1.4"/>
    <path id="project.classpath">
        <fileset dir="${idea.dir}\lib" includes="*.jar"/>
    </path>

    <target name="init">
        <mkdir dir="${build.dir}"/>
        <mkdir dir="${build.dir}/META-INF"/>
        <mkdir dir="${dist.dir}"/>
        <mkdir dir="${javadoc.dir}"/>
    </target>

    <target name="clean">
        <delete dir="${build.dir}"/>
        <delete dir="${dist.dir}"/>
        <delete dir="${javadoc.dir}"/>
    </target>

    <target name="compile" depends="init">
        <javac srcdir="${src.java.dir}"
            destdir="${build.dir}"
            debug="${compile.debug}"
            deprecation="${compile.deprecation}"
            optimize="${compile.optimize}"
            target="${compile.target}"
            source="${compile.source}">
            <classpath refid="project.classpath"/>
        </javac>
    </target>

    <target name="dist-jar" depends="compile">
        <copy todir="${build.dir}/resources">
            <fileset dir="resources" excludes="inspectionDescriptions,inspectionDescriptions/*.*"/>
        </copy>

        <copy tofile="${build.dir}/META-INF/plugin.xml" file="${src.dir}/META-INF/plugin.xml"/>
        <jar jarfile="${dist.dir}/${name}.jar">
            <fileset dir="${build.dir}"/>
            <fileset dir="resources">
                <include name="inspectionDescriptions/*.html"/>
            </fileset>
        </jar>
    </target>

    <target name="dist-src" depends="compile">
        <copy todir="${build.dir}/src">
            <fileset dir="${src.java.dir}"/>
        </copy>
        <copy todir="${build.dir}/META-INF">
            <fileset dir="META-INF"/>
        </copy>
        <copy todir="${build.dir}/resources">
            <fileset dir="resources"/>
        </copy>
        <jar jarfile="${dist.dir}/${name}-src.jar">
            <fileset dir="." file="build.xml"/>
            <fileset dir="." file="project.properties"/>
            <fileset dir="." file="README.TXT"/>
            <fileset dir="." file="CHANGELOG.TXT"/>
            <fileset dir="." file="CONTRIB.TXT"/>
            <fileset dir="${build.dir}" includes="src/**/*,META-INF/**/*,resources/**/*"/>
        </jar>
    </target>

    <target name="dist" depends="dist-jar, dist-src">
        <jar file="${dist.dir}/${name}.jar" update="true">
            <zipfileset file="${dist.dir}/${name}-src.jar"/>
        </jar>
    </target>

    <target name="deploy-idea" depends="dist-jar">
        <copy todir="${deploy.dir}" file="${dist.dir}/${name}.jar"/>
    </target>

    <target name="deploy-idea-sandbox" depends="dist-jar">
        <copy todir="${deploy.sandbox.dir}" file="${dist.dir}/${name}.jar"/>
    </target>

    <target name="javadoc" depends="compile">
        <javadoc destdir="${javadoc.dir}"
                 packagenames="com.holmbech.*"
                 sourcepath="${src.java.dir}"
                 use="false"
                 author="true"
                 version="false"
                 windowtitle="Generate Wicket Assistant plugin for Intellij IDEA"
                 doctitle="Generate Wicket Assistant plugin for Intellij IDEA"
                 public="true"
                 breakiterator="true">
            <classpath refid="project.classpath"/>
        </javadoc>
    </target>

    <target name="touch-src">
        <touch datetime="28/01/2006 2:00 pm">
            <fileset dir="${src.dir}" includes="**/*"/>
        </touch>
    </target>

</project>